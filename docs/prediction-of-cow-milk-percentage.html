<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Prediction of cow milk percentage | Applied Methods in Statistics</title>
  <meta name="description" content="This contains the weekly exercises related to Applied Methods in Statistics (STAT340)">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Prediction of cow milk percentage | Applied Methods in Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This contains the weekly exercises related to Applied Methods in Statistics (STAT340)" />
  <meta name="github-repo" content="mathatistics/stat340-2019" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Prediction of cow milk percentage | Applied Methods in Statistics" />
  
  <meta name="twitter:description" content="This contains the weekly exercises related to Applied Methods in Statistics (STAT340)" />
  

<meta name="author" content="Thore Egeland and Kathrine Frey Frøslie">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="multivariate-analysis-pcr-pls.html">
<link rel="next" href="discrimination-and-classification.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113782065-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113782065-1');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Methods in Statistics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Practical Information</a><ul>
<li class="chapter" data-level="" data-path="lecture-and-exercise-plan.html"><a href="lecture-and-exercise-plan.html"><i class="fa fa-check"></i>Lecture and Exercise Plan</a></li>
<li class="chapter" data-level="" data-path="reference-books.html"><a href="reference-books.html"><i class="fa fa-check"></i>Reference Books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i>Getting Started</a><ul>
<li class="chapter" data-level="" data-path="exercise-1-create-new-project.html"><a href="exercise-1-create-new-project.html"><i class="fa fa-check"></i>Exercise 1: Create New Project</a></li>
<li class="chapter" data-level="" data-path="exercise-2-importing-data-in-r.html"><a href="exercise-2-importing-data-in-r.html"><i class="fa fa-check"></i>Exercise 2: Importing data in R</a><ul>
<li><a href="exercise-2-importing-data-in-r.html#import-txt-or-csv">Import <code>txt</code> or <code>csv</code></a></li>
<li class="chapter" data-level="" data-path="exercise-2-importing-data-in-r.html"><a href="exercise-2-importing-data-in-r.html#import-microsoft-excel-spreadsheet"><i class="fa fa-check"></i>Import Microsoft Excel spreadsheet</a></li>
<li><a href="exercise-2-importing-data-in-r.html#load-rdata-rda-or-rds">Load <code>rdata</code>, <code>rda</code> or <code>rds</code></a></li>
<li class="chapter" data-level="" data-path="exercise-2-importing-data-in-r.html"><a href="exercise-2-importing-data-in-r.html#reading-data-from-clipboard-pasting-copied-data-into-an-r-object"><i class="fa fa-check"></i>Reading data from clipboard (“pasting” copied data into an R object)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-3-exporting-data-to-a-file.html"><a href="exercise-3-exporting-data-to-a-file.html"><i class="fa fa-check"></i>Exercise 3: Exporting data to a file</a></li>
<li class="chapter" data-level="" data-path="exercise-4-data-structure-in-r.html"><a href="exercise-4-data-structure-in-r.html"><i class="fa fa-check"></i>Exercise 4: Data Structure in R</a><ul>
<li class="chapter" data-level="" data-path="exercise-4-data-structure-in-r.html"><a href="exercise-4-data-structure-in-r.html#vector"><i class="fa fa-check"></i>Vector</a></li>
<li class="chapter" data-level="" data-path="exercise-4-data-structure-in-r.html"><a href="exercise-4-data-structure-in-r.html#matrix"><i class="fa fa-check"></i>Matrix</a></li>
<li class="chapter" data-level="" data-path="exercise-4-data-structure-in-r.html"><a href="exercise-4-data-structure-in-r.html#array"><i class="fa fa-check"></i>Array</a></li>
<li class="chapter" data-level="" data-path="exercise-4-data-structure-in-r.html"><a href="exercise-4-data-structure-in-r.html#list"><i class="fa fa-check"></i>List</a></li>
<li class="chapter" data-level="" data-path="exercise-4-data-structure-in-r.html"><a href="exercise-4-data-structure-in-r.html#data-frame"><i class="fa fa-check"></i>Data Frame</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html"><i class="fa fa-check"></i>Exercise 5: Exploring the data</a><ul>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html#structure-of-an-r-object"><i class="fa fa-check"></i>Structure of an R-object</a></li>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html#accessing-elements-from-r-objects"><i class="fa fa-check"></i>Accessing elements from R-objects</a></li>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html#view-data-in-rstudio"><i class="fa fa-check"></i>View Data in RStudio</a></li>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html#summary-of-data"><i class="fa fa-check"></i>Summary of data</a></li>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html#dimension-of-data"><i class="fa fa-check"></i>Dimension of data</a></li>
<li class="chapter" data-level="" data-path="exercise-5-exploring-the-data.html"><a href="exercise-5-exploring-the-data.html#lets-practice"><i class="fa fa-check"></i>Lets Practice</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-6-subsets-of-data-and-logical-operators.html"><a href="exercise-6-subsets-of-data-and-logical-operators.html"><i class="fa fa-check"></i>Exercise 6: Subsets of data and logical operators</a><ul>
<li class="chapter" data-level="" data-path="exercise-6-subsets-of-data-and-logical-operators.html"><a href="exercise-6-subsets-of-data-and-logical-operators.html#logical-vector-and-index-vector"><i class="fa fa-check"></i>Logical vector and index vector</a></li>
<li class="chapter" data-level="" data-path="exercise-6-subsets-of-data-and-logical-operators.html"><a href="exercise-6-subsets-of-data-and-logical-operators.html#subsetting-data-frame"><i class="fa fa-check"></i>Subsetting data frame</a></li>
<li class="chapter" data-level="" data-path="exercise-6-subsets-of-data-and-logical-operators.html"><a href="exercise-6-subsets-of-data-and-logical-operators.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exercise-7-graphics.html"><a href="exercise-7-graphics.html"><i class="fa fa-check"></i>Exercise 7: Graphics</a><ul>
<li class="chapter" data-level="" data-path="exercise-7-graphics.html"><a href="exercise-7-graphics.html#spice-up-the-plot"><i class="fa fa-check"></i>Spice up the plot</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="regression-analysis.html"><a href="regression-analysis.html"><i class="fa fa-check"></i>Regression Analysis</a><ul>
<li class="chapter" data-level="" data-path="least-sqaures-app.html"><a href="least-sqaures-app.html"><i class="fa fa-check"></i>Least Sqaures App</a></li>
<li class="chapter" data-level="" data-path="dataset-birth.html"><a href="dataset-birth.html"><i class="fa fa-check"></i>Dataset: birth</a><ul>
<li><a href="dataset-birth.html#overview-of-data"><i class="fa fa-edit"></i> Overview of data</a></li>
<li><a href="dataset-birth.html#linear-regression"><i class="fa fa-book"></i> Linear Regression</a></li>
<li><a href="dataset-birth.html#regression-with-categories"><i class="fa fa-book"></i> Regression with categories</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataset-bodydata.html"><a href="dataset-bodydata.html"><i class="fa fa-check"></i>Dataset: bodydata</a><ul>
<li><a href="dataset-bodydata.html#training-samples"><i class="fa fa-book"></i> Training Samples</a></li>
<li><a href="dataset-bodydata.html#fitting-model"><i class="fa fa-edit"></i> Fitting Model</a></li>
<li><a href="dataset-bodydata.html#understanding-the-fitted-model"><i class="fa fa-edit"></i> Understanding the fitted Model</a></li>
<li><a href="dataset-bodydata.html#multiple-linear-regression-and-prediction"><i class="fa fa-edit"></i> Multiple Linear Regression and Prediction</a></li>
<li><a href="dataset-bodydata.html#extra-on-r-squared"><i class="fa fa-book"></i> Extra on R-squared</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html"><i class="fa fa-check"></i>Dataset: mtcars</a><ul>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html#ex-1-model-fitting"><i class="fa fa-check"></i>Ex-1: Model Fitting</a></li>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html#ex-2-indicator-variable"><i class="fa fa-check"></i>Ex-2: Indicator variable</a></li>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html#ex-3-comparing-models---partial-f-test"><i class="fa fa-check"></i>Ex-3: Comparing models - Partial F-test</a></li>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html#ex-4-influential-measurements"><i class="fa fa-check"></i>Ex-4: Influential measurements</a></li>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html#ex-5-model-selection"><i class="fa fa-check"></i>Ex-5: Model selection</a></li>
<li class="chapter" data-level="" data-path="dataset-mtcars.html"><a href="dataset-mtcars.html#ex-6-model-validation"><i class="fa fa-check"></i>Ex-6: Model validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="analysis-of-variance.html"><a href="analysis-of-variance.html"><i class="fa fa-check"></i>Analysis of variance</a><ul>
<li class="chapter" data-level="" data-path="chlorine-levels-in-cities.html"><a href="chlorine-levels-in-cities.html"><i class="fa fa-check"></i>Chlorine levels in cities</a></li>
<li class="chapter" data-level="" data-path="data-from-the-nsr-education-test.html"><a href="data-from-the-nsr-education-test.html"><i class="fa fa-check"></i>Data from the NSR education test</a></li>
<li class="chapter" data-level="" data-path="barley-data.html"><a href="barley-data.html"><i class="fa fa-check"></i>Barley Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multivariate-analysis-pca.html"><a href="multivariate-analysis-pca.html"><i class="fa fa-check"></i>Multivariate Analysis (PCA)</a><ul>
<li class="chapter" data-level="" data-path="track-and-field-data.html"><a href="track-and-field-data.html"><i class="fa fa-check"></i>Track and Field data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multivariate-analysis-pcr-pls.html"><a href="multivariate-analysis-pcr-pls.html"><i class="fa fa-check"></i>Multivariate Analysis (PCR, PLS)</a><ul>
<li class="chapter" data-level="" data-path="prediction-of-cow-milk-percentage.html"><a href="prediction-of-cow-milk-percentage.html"><i class="fa fa-check"></i>Prediction of cow milk percentage</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="discrimination-and-classification.html"><a href="discrimination-and-classification.html"><i class="fa fa-check"></i>Discrimination and classification</a><ul>
<li class="chapter" data-level="" data-path="iris-dataset.html"><a href="iris-dataset.html"><i class="fa fa-check"></i>Iris Dataset</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="generalized-linear-model.html"><a href="generalized-linear-model.html"><i class="fa fa-check"></i>Generalized Linear Model</a><ul>
<li class="chapter" data-level="" data-path="species-data.html"><a href="species-data.html"><i class="fa fa-check"></i>Species Data</a></li>
<li class="chapter" data-level="" data-path="taxonomy-data.html"><a href="taxonomy-data.html"><i class="fa fa-check"></i>Taxonomy Data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="random-effect-model.html"><a href="random-effect-model.html"><i class="fa fa-check"></i>Random Effect Model</a><ul>
<li class="chapter" data-level="" data-path="litter-sizes.html"><a href="litter-sizes.html"><i class="fa fa-check"></i>Litter sizes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-effect-model.html"><a href="mixed-effect-model.html"><i class="fa fa-check"></i>Mixed Effect Model</a><ul>
<li class="chapter" data-level="" data-path="exercises-and-diet.html"><a href="exercises-and-diet.html"><i class="fa fa-check"></i>Exercises and Diet</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exam-questions.html"><a href="exam-questions.html"><i class="fa fa-check"></i>Exam Questions</a><ul>
<li class="chapter" data-level="" data-path="exam-2016.html"><a href="exam-2016.html"><i class="fa fa-check"></i>Exam 2016</a><ul>
<li class="chapter" data-level="" data-path="exam-2016.html"><a href="exam-2016.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="exam-2016.html"><a href="exam-2016.html#exersise-2"><i class="fa fa-check"></i>Exersise 2</a></li>
<li class="chapter" data-level="" data-path="exam-2016.html"><a href="exam-2016.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exam-2017.html"><a href="exam-2017.html"><i class="fa fa-check"></i>Exam 2017</a><ul>
<li class="chapter" data-level="" data-path="exam-2017.html"><a href="exam-2017.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="exam-2017.html"><a href="exam-2017.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="exam-2017.html"><a href="exam-2017.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="exam-2017.html"><a href="exam-2017.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="exam-2017.html"><a href="exam-2017.html#appendix-to-exam-stat340"><i class="fa fa-check"></i>Appendix to exam STAT340</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a name="title" href="javascript:void(0)"><b>Lecturer:</b></a><ul>
<li><a href="https://www.nmbu.no/ans/thore.egeland" target="blank">Thore Egeland</a></li></ul></li>
<li><a name="title" href="javascript:void(0)"><b>Assistent Teachers:</b></a><ul>
<li><a href="https://www.nmbu.no/ans/raju.rimal" target="blank">Kathrine Frey Frøslie</a></li></ul></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Methods in Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="prediction-of-cow-milk-percentage" class="section level2">
<h2>Prediction of cow milk percentage</h2>
<p>In the data file “<code>maldidata.rdata</code>” you find four objects:</p>
<ul>
<li><code>Y</code> : The percentage of cow-milk for 4 replicates of 45 different milk mixtures</li>
<li><code>X</code> : Mass Spectrometry data (<code>MALDI-TOF</code>) for the milk samples. The 6179 variables is a quantification of molecule “<code>size</code>” and “<code>charge</code>” in a sample. For simplicity we may say that the size of molecules increases from variable 1 to variable 6179. The measurements are then amounts of molecules of different sizes. The method is used to separate proteins, peptides and other ionizable compunds.</li>
<li><code>Ytest</code> : Cow-milk percentages for 45 extra test samples</li>
<li><code>Xtest</code> : The <code>MALDI-TOF</code> values for the test samples.</li>
</ul>
<p>You may plot the spectra in <code>X</code> one-by-one as,:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(X[, <span class="dv">1</span>], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</code></pre></div>
<p><img src="STAT340-2018_files/figure-html/unnamed-chunk-151-1.svg" width="672" /></p>
<p>We can also plot multiple (all) spectra together, takes more time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">matplot</span>(X[, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>)</code></pre></div>
<p><img src="STAT340-2018_files/figure-html/unnamed-chunk-152-1.svg" width="672" /></p>
<p>The peaks show molecule sizes that are abundant in the sample.</p>
<ul>
<li>First run a PCA on <code>X</code>. How many components are needed to explain 80% and 90% of the variability in <code>X</code>?</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pr &lt;-<span class="st"> </span><span class="kw">prcomp</span>(X)
<span class="kw">summary</span>(pr)<span class="op">$</span>importance[, <span class="dv">1</span><span class="op">:</span><span class="dv">14</span>]</code></pre></div>
<pre><code>                          PC1    PC2    PC3    PC4    PC5    PC6     PC7
Standard deviation     12.502 4.4833 3.0218 2.5373 2.0112 1.7430 1.30637
Proportion of Variance  0.648 0.0833 0.0379 0.0267 0.0168 0.0126 0.00708
Cumulative Proportion   0.648 0.7313 0.7691 0.7958 0.8126 0.8252 0.83228
                          PC8     PC9    PC10    PC11    PC12    PC13
Standard deviation     1.0875 1.05133 0.96666 0.91363 0.84363 0.83145
Proportion of Variance 0.0049 0.00458 0.00387 0.00346 0.00295 0.00287
Cumulative Proportion  0.8372 0.84176 0.84564 0.84910 0.85205 0.85491
                          PC14
Standard deviation     0.81638
Proportion of Variance 0.00276
Cumulative Proportion  0.85768</code></pre>
<p>We need 5 components to explain 80% and 36 to explain 90% (check yourself). Hopefully we do not need to use all X-information to predict <code>Y</code>.</p>
</div>
<ul>
<li>Compute the correlations between <span class="math inline">\(Y\)</span> and the principal components. How can you use this get an idea of how many components PLS-regression will require to make a good model for cow-milk prediction?</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(Y, pr<span class="op">$</span>x)</code></pre></div>
<pre><code>       PC1    PC2    PC3    PC4    PC5     PC6   PC7    PC8      PC9
[1,] 0.528 -0.754 0.0338 -0.225 0.0744 -0.0503 0.015 -0.166 -0.00757
        PC10   PC11    PC12   PC13   PC14    PC15    PC16   PC17    PC18
[1,] -0.0754 -0.137 -0.0432 0.0183 0.0167 -0.0155 -0.0263 0.0222 -0.0187
         PC19    PC20    PC21    PC22    PC23    PC24    PC25    PC26
[1,] -0.00495 -0.0413 0.00649 -0.0187 -0.0442 -0.0069 -0.0411 0.00412
        PC27  PC28    PC29   PC30     PC31   PC32    PC33   PC34     PC35
[1,] -0.0123 0.017 -0.0147 0.0387 0.000618 0.0185 -0.0213 0.0478 -0.00964
        PC36     PC37  PC38   PC39     PC40    PC41   PC42   PC43    PC44
[1,] -0.0106 -0.00503 0.021 -0.011 -0.00874 -0.0191 -0.014 0.0082 -0.0124
       PC45    PC46   PC47    PC48   PC49     PC50     PC51    PC52
[1,] 0.0176 0.00597 0.0141 -0.0193 0.0217 -0.00107 -0.00454 0.00781
        PC53    PC54   PC55     PC56    PC57    PC58     PC59      PC60
[1,] 0.00674 -0.0041 0.0027 -0.00404 -0.0269 0.00521 -0.00471 -0.000586
       PC61    PC62   PC63    PC64     PC65    PC66   PC67    PC68
[1,] 0.0124 -0.0142 0.0125 -0.0181 -0.00766 0.00276 0.0146 -0.0221
         PC69     PC70     PC71     PC72   PC73    PC74    PC75   PC76
[1,] -0.00245 -0.00385 -0.00334 -0.00403 -0.038 -0.0394 0.00702 0.0103
       PC77    PC78    PC79     PC80    PC81     PC82   PC83    PC84
[1,] -0.017 -0.0104 -0.0116 -0.00895 0.00664 -0.00716 0.0086 -0.0205
        PC85  PC86   PC87    PC88   PC89    PC90     PC91    PC92     PC93
[1,] -0.0217 0.018 0.0284 0.00673 0.0166 0.00445 -0.00696 -0.0109 -0.00113
       PC94   PC95    PC96     PC97   PC98     PC99    PC100    PC101
[1,] 0.0244 0.0304 -0.0186 -0.00388 0.0214 -0.00707 -0.00238 0.000283
      PC102    PC103   PC104   PC105  PC106  PC107   PC108   PC109  PC110
[1,] 0.0251 -0.00757 -0.0175 -0.0259 0.0244 -0.026 0.00272 -0.0157 0.0142
       PC111  PC112   PC113  PC114   PC115   PC116 PC117    PC118   PC119
[1,] -0.0115 -0.009 -0.0115 0.0299 0.00924 0.00246 -0.01 -0.00907 -0.0242
       PC120   PC121  PC122   PC123   PC124   PC125   PC126   PC127  PC128
[1,] 0.00516 -0.0066 0.0147 0.00467 -0.0254 -0.0224 -0.0124 0.00816 0.0101
       PC129   PC130    PC131   PC132    PC133   PC134    PC135  PC136
[1,] -0.0142 -0.0119 -0.00018 -0.0108 -0.00172 0.00275 -0.00635 0.0103
       PC137   PC138   PC139    PC140    PC141  PC142    PC143   PC144
[1,] -0.0087 0.00552 0.00742 -0.00805 -0.00327 0.0159 -0.00109 0.00291
        PC145    PC146    PC147    PC148   PC149    PC150  PC151   PC152
[1,] -0.00378 -0.00148 -0.00736 -0.00656 0.00354 -0.00579 0.0034 0.00252
      PC153    PC154   PC155  PC156  PC157    PC158    PC159   PC160
[1,] 0.0015 -0.00918 -0.0111 0.0232 0.0108 -0.00734 -0.00148 0.00503
        PC161    PC162    PC163   PC164    PC165   PC166   PC167   PC168
[1,] -0.00242 -0.00583 -0.00701 0.00558 -0.00344 0.00436 0.00368 0.00529
      PC169   PC170   PC171    PC172    PC173  PC174   PC175     PC176
[1,] -0.015 -0.0092 -0.0134 -0.00933 -0.00255 0.0113 0.00024 -0.000418
       PC177   PC178  PC179  PC180
[1,] -0.0057 -0.0103 0.0218 0.0288</code></pre>
<p>Components 1, 2, 4 and perhaps 8 are moderately to highly correlated with <code>Y</code>. Supposedly 3 to 4 components will be necessary for PLSR.</p>
</div>
<ul>
<li>Fit a PLS-regression model using <code>Y</code> as response and <code>X</code> as predictor (You may simply write <code>Y ~ X</code> as your model call in <code>plsr</code>. Also use <code>ncomp=10</code> as extra argument to only fit 1 to 10 components). Use the <code>scoreplot()</code> function to make a scoreplot. Check the help-file for this function to see how you can chose the component numbers to plot, and how you can put labels to your observations. Plot component 1 against 2 and put observation numbers 1:180 as labels. If the noise level of the measurements is low, the replicates should group in clusters of size four (obs 1,2,3 and 4 are from the same mixture, and so on). Do you see any tendency to this?</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plsmod &lt;-<span class="st"> </span><span class="kw">plsr</span>(Y <span class="op">~</span><span class="st"> </span>X, <span class="dt">ncomp =</span> <span class="dv">10</span>)
<span class="kw">scoreplot</span>(plsmod, <span class="dt">comps =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="dt">labels =</span> <span class="st">&#39;names&#39;</span>, <span class="dt">pch =</span> <span class="fl">0.7</span>)</code></pre></div>
<p><img src="STAT340-2018_files/figure-html/unnamed-chunk-155-1.svg" width="100%" /></p>
<p>We observe that there are clusters of observations and that there is a tendency of successive numbers to be close in the scoreplot. Cluster sizes are difficult to determine.</p>
</div>
<ul>
<li>Perform hierarchical clustering of the samples using the 3 first PLS-component scores as input variables. Try both “complete” and “average” agglomeration method and make a dendrogram. Are the replicate clusters more apparent in the dendrogram than in the scoreplot? Is there any samples that are very different from all others?</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clust1 &lt;-<span class="st"> </span><span class="kw">hclust</span>(<span class="kw">dist</span>(plsmod<span class="op">$</span>scores[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]), <span class="dt">method =</span> <span class="st">&quot;complete&quot;</span>)
<span class="kw">plot</span>(clust1, <span class="dt">cex =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="STAT340-2018_files/figure-html/unnamed-chunk-156-1.svg" width="100%" /></p>
<p>From the dendrogram we observe several clusters of size four, and some of three with successive observation numbers. This implies that the replicates are more similar to each other than samples from different milk samples. Sample 159 seems to be an outlier, very different from all others.</p>
</div>
<ul>
<li>Use K-means clustering with K=45 on the three first PLS-component scores. How do the replicates cluster?</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clust2 &lt;-<span class="st"> </span><span class="kw">kmeans</span>(plsmod<span class="op">$</span>scores[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="dt">centers =</span> <span class="dv">45</span>)
clust2<span class="op">$</span>cluster</code></pre></div>
<pre><code>  1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18 
 39  39  39  39  13  13  13  44  20  20  20  20  31  31  31  31  38  15 
 19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36 
 38  15  13   1   1  40  25  25  14  17   2   2   2   2  22  32  22  32 
 37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54 
 25  17  25  25  44  23   9  34   3   3   3   3  11  11  19  23  17  24 
 55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72 
 24  24  30  30  14  14  40  23  40  39   9   9   9   9   1  30   1  13 
 73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90 
 12  45  45  45  44  44  33  22   5  13  12  35  34  34  34  23  14  17 
 91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108 
 17  17   6   6  28  28  42  42  42  42  22  32  43  43   7   7   7   7 
109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 
 38  38  38  38   4   4   4   4  37  37  37  37  41   8   8  41  29  29 
127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 
 29  26  25  16  16  16  25  41  25  25  35   5   5  35  42  42  42  42 
145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 
 21  21  21  21  36  36  36  36  18  18  18  18  33   6  27  28   8   8 
163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 
  8  30  14  41  41  16  12  45  45  35  10  30  10  10  15  15   3  15 </code></pre>
<p>Many replicates fall into the same clusters, but some clusters observations from more than one “true” cluster. E.g. cluster number 43 contains observations (97, 98, 99, 100) and (141, 142, 143, 144), which is a mixture of four true replica clusters. We conclude that the replicates are somewhat similar, but there is some noise in the <code>MALDI-TOF</code> data which makes similar milk mixtures hard to distinguish.</p>
</div>
<ul>
<li>We will use cross-validation to estimate the expected prediction error of PLSR and to choose the appropriate number of components. Instead of using Leave-One-Out Cross-validation we will exclude all four replicates in a “Leave-Four-Out” type of Cross-validation. Why is this smart?</li>
</ul>
<div class="ans">
<p>Since the replicates are from the same mixture, they are not independent. If we use Leave-One-Out CV the three replicates still contained in the training set will make the model “too good” to predict the given mixture, and we will under-estimate the prediction error of new samples.</p>
</div>
<ul>
<li>Refit the plsmodel from exercise c. but add the arguments <code>validation=&quot;CV&quot;</code>, <code>segments=45</code> and <code>segment.type=&quot;consecutive&quot;</code> in the plsr-model call. This sets up the “Leave-Four-Out” CV to be performed.</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plsmod &lt;-<span class="st"> </span><span class="kw">plsr</span>(Y <span class="op">~</span><span class="st"> </span>X, <span class="dt">ncomp =</span> <span class="dv">10</span>, <span class="dt">validation =</span> <span class="st">&quot;CV&quot;</span>, 
               <span class="dt">segments =</span> <span class="dv">45</span>, <span class="dt">segment.type =</span> <span class="st">&quot;consecutive&quot;</span>)</code></pre></div>
</div>
<ul>
<li>The sum of squared prediction errors (PRESS) for different number of components is given in the <code>validation$PRESS</code> element of the fitted pls-model. The null-model PRESS (prediction using the mean-response) is given in the <code>validation$PRESS0</code> element. You find the MSEP-values (Mean Squared Error of Prediction) by dividing the PRESS by the number of observations (N=180). Make a prediction error plot of MSEP with 0 to 10 components. How many components do you think gives satisfying prediction of cow-milk content in new mixtures? Remember that simple models are often better than complex.</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MSEP &lt;-<span class="st"> </span><span class="kw">c</span>(plsmod<span class="op">$</span>validation<span class="op">$</span>PRESS0, plsmod<span class="op">$</span>validation<span class="op">$</span>PRESS)<span class="op">/</span><span class="dv">180</span>
<span class="kw">plot</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, MSEP, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="STAT340-2018_files/figure-html/unnamed-chunk-160-1.svg" width="672" /></p>
<p>The prediction error is heavily reduced as we introduce components 1 and 2, but there is a small gain by adding components 3, 4 and 5. Simple models are usually more robust, so I would not go any further than 5 components here.</p>
</div>
<ul>
<li>Predict the cow-milk content of the test samples using <code>Xtest</code> as newdata in the <code>predict</code>-function and use the number of components you found as best from the previous exercise. Save the predictions into an object called <code>pred</code>. (See <code>?predict.mvr</code> for the help-file to predict for pls-objects.). The predict-function returns an array of dimension [45,1,1] of predictions. You can extract all predictions by <code>pred[,1,1]</code>.</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pred &lt;-<span class="st"> </span><span class="kw">predict</span>(plsmod, <span class="dt">newdata =</span> Xtest, <span class="dt">ncomp =</span> <span class="dv">5</span>)</code></pre></div>
</div>
<p>Copy the folowing code into R and execute:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MSEPfunc &lt;-<span class="st"> </span><span class="cf">function</span>(y, yhat){
    <span class="kw">mean</span>((y <span class="op">-</span><span class="st"> </span>yhat) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)
}</code></pre></div>
<ul>
<li>Use <code>MSEPfunc()</code> to compute the MSEP-value for the test-predictions using <code>Ytest</code> and the predicted values as inputs. Did the cross-validation under-estimate the prediction error?</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">MSEPfunc</span>(Ytest, pred[,<span class="dv">1</span>,<span class="dv">1</span>])</code></pre></div>
<pre><code>[1] 0.00692</code></pre>
<p>The MSEP-value is slightly larger than the value found for five components using Cross-validation, but the order of magnitude is the same.</p>
</div>
<ul>
<li>EXTRA for those interested. Redo the exercises g. and h. with Leave-One-Out CV. (See also lecture notes Lesson 7.) Compare the MSEP-values you find with the previous CV-routine.</li>
</ul>
<div class="ans">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plsmod2 &lt;-<span class="st"> </span><span class="kw">plsr</span>(Y <span class="op">~</span><span class="st"> </span>X, <span class="dt">ncomp =</span> <span class="dv">10</span>, <span class="dt">validation =</span> <span class="st">&quot;LOO&quot;</span>)
MSEP2 &lt;-<span class="st"> </span><span class="kw">c</span>(plsmod2<span class="op">$</span>validation<span class="op">$</span>PRESS0, plsmod2<span class="op">$</span>validation<span class="op">$</span>PRESS)<span class="op">/</span><span class="dv">180</span>
<span class="kw">plot</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, MSEP, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
<span class="kw">points</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, MSEP2, <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>, <span class="dt">col =</span> <span class="dv">4</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="STAT340-2018_files/figure-html/unnamed-chunk-164-1.svg" width="672" /></p>
<p>We see that LOO-CV underestimates the prediction error, as commented in exercise f.</p>
</div>

</div>
<!-- </div> -->
<script>
  ans_btn_html = '<a class = "btn-ans"><span class="label label-success no-print">&lt;ANS/&gt;</span></a>';
  showAns_btn = '<a class="showAns-btn btn pull-right js-toolbar-action">Show Answers</a>';
  hideAns_btn = '<a class="hideAns-btn btn pull-right js-toolbar-action" style="display:none;">Hide Answers</a>';
  
  // Adding Extra Menus in Navigation
  
  // Adding button on before each answer:::
  $(".ans").before(ans_btn_html);
  $('.btn-ans').each(function(){
    $(this).next('.ans').andSelf().wrapAll('<div class="wrap-ans"/>');
  });
  $('.btn-ans').click(function(){
    $(this).siblings('.ans').toggle(400);
  });
  
if ($(".ans").length > 0){
    $('.book-header').prepend(showAns_btn, hideAns_btn);
    $('.showAns-btn').show();
    $('.showAns-btn').click(function(){
      $('.btn-ans').hide(400);
      $('.ans').show(400);
      $('.hideAns-btn').show();
      $(this).hide();
      $('.hideAns-btn').click(function(){
        $('.btn-ans').show(400);
        $('.ans').hide(400);
        $('.showAns-btn').show();
        $(this).hide();
      });
    });
  }

var chap = "week-two"
if(window.location.href.indexOf(chap) != -1){
  var now = new Date();
  var release = new Date("August 21, 2016");
  if(now < release){
    $(".ans, .btn-ans, .showAns-btn, .hideAns-btn").hide()
  }
}

$('.ans p:has(img)').css('text-align', 'center');
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-82812028-1', 'auto');
  ga('send', 'pageview');

</script>
            </section>

          </div>
        </div>
      </div>
<a href="multivariate-analysis-pcr-pls.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discrimination-and-classification.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["STAT340-2018.pdf", "STAT340-2018.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
